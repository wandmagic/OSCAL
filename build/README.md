# OSCAL Build Tools

This subdirectory contains infrastructure used to create OSCAL-related artifacts (e.g., schemas) and perform status checks.
Below are instructions for using these tools.

## Prerequisites

The build tools in this directory require a Unix environment with the following software:

- [Maven](https://maven.apache.org/): Required to generate artifacts
- [NodeJS](https://nodejs.org/en) (ensure the version matches [`.nvmrc`](./.nvmrc)): Required to perform link checking
- [oscal-cli](https://github.com/metaschema-framework/oscal-cli) for schema generation & validation

Additionally ensure your environment has standard build tools such as [`git` 2.34.1 or newer](https://git-scm.com/), [`make` 4.3 or newer](https://git.savannah.gnu.org/cgit/make.git/tree/README.git), [`zip` 3.0 or newer](https://infozip.sourceforge.net/), and [`bash` 3.2 or newer for syntax we require](https://git.savannah.gnu.org/cgit/bash.git/tree/NEWS?h=bash-3.2-beta).

## Building

### Overview

All OSCAL build targets are defined in a [`Makefile`](./Makefile).
To summarize the build targets, run `make help`.
To generate all artifacts and run all checks, simply run `make all`.

To run targets in parallel, pass a `--jobs <n>` flag, where `<n>` is the number of concurrent jobs and should be `<=` your machine's core count.
Note that running jobs concurrently will make the output harder to follow and debug.

### Artifact Generation

As of `v1.1.0`, artifacts are no longer tracked in the OSCAL git repository ([discussion link](https://github.com/usnistgov/OSCAL/discussions/1852)).
Instead artifacts are [generated as part of a release](../.github/workflows/release.yml).

Developers can generate schemas locally using the `make artifacts` command.

Developers can also generate individual artifacts using the following commands:

* `make schemas`: Generates the JSON Schemas and XSDs off of the source Metaschemas;
* `make build`: runs all steps and checks;

### Checks

Developers can run checks using the `make checks` command.

The checks can also be run individually:

* `make linkcheck`: Checks each markdown file in the repository for bad links;
* `make validate-jsonschemas`: Validates that the JSON schemas generated by `make schemas` are schema valid against the JSON Schema specification;
* `make validate-xsds`: Validates that the XSD files generated by `make schemas` are schema valid against the XSD specification;
* `make test-profile-resolution`: Runs the test suite in [`/src/utils/resolver-pipeline`](../src/utils/resolver-pipeline/).

### Archive Generation

`make archives` generates `.zip` and `.tar.bz2` archives with the [generated artifacts](#archive-generation).

By default, archives will have the suffix `SNAPSHOT`, but this can be overridden using the `RELEASE` variable:

```sh
$ make archive RELEASE=my_release
```

## Artifact Usage

### Schemas

The OSCAL project provides JSON Schemas based on the [JSON Schema Draft-07](https://json-schema.org/specification-links.html#draft-7) and XML Schema based on the [XML Schema Definition Language (XSD) 1.1](https://www.w3.org/TR/xmlschema11-1/) for all [OSCAL models](https://pages.nist.gov/OSCAL/documentation/schema/).

After running `make schemas`, JSON Schemas and XSD files will be created in the `generated/` directory, following the general pattern `oscal_[MODEL_NAME]_schema.json` and `oscal_[MODEL_NAME]_schema.xsd`.

Pre-built schemas are also distributed as part of a [release](https://github.com/usnistgov/OSCAL/releases).

#### Validating OSCAL JSON Content

The OSCAL project uses the [Another Json Validator](https://ajv.js.org/) (AJV) [command line interface](https://github.com/jessedc/ajv-cli) (CLI) to perform automated validation of all JSON-based OSCAL [content](https://github.com/usnistgov/oscal-content) provided in this repository. *ajv-cli* is an open source tool that can be [installed](https://github.com/jessedc/ajv-cli#installation), and run on OSX, Linux, and Windows environments, with a [Node.js](https://nodejs.org/en/download/current/) environment installed. Node.js is the JavaScript runtime environment that is required to run AJV.

The following example uses the **ajv-cli** to perform validation of an OSCAL catalog JSON file.

```
ajv validate -s "oscal_catalog_schema.json" -d "catalog.json" --extend-refs=true --verbose
```

The [online documentation](https://github.com/jessedc/ajv-cli) for *ajv-cli* provides more information on the command-line arguments.

#### Validating OSCAL XML Content

The OSCAL project uses [xmllint](http://xmlsoft.org/xmllint.html) to perform automated validation of all XML-based OSCAL [content](https://github.com/usnistgov/oscal-content) provided in this repository. *xmllint* is an open source tool that can be [downloaded](http://xmlsoft.org/downloads.html), installed, and run on OSX, Linux, and Windows environments.

The following example uses **oscal-cli** to perform validation of an OSCAL catalog XML file.

```
oscal-cli metaschema -m oscal_catalog_metaschema.xml validate-content catalog.xml
```

The [online documentation](http://xmlsoft.org/xmllint.html) for *xmllint* provides more information on the command-line arguments.


#### Converting OSCAL XML Content to JSON

The following example uses **oscal-cli** to perform validation of an OSCAL catalog XML file.

```
oscal-cli convert catalog.xml --to=JSON catalog.json
```


#### Converting OSCAL JSON Content to XML

```
oscal-cli convert catalog.json --to=XML catalog.xml
```


